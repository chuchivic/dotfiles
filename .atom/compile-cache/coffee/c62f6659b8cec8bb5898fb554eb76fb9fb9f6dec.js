(function() {
  var MarkdownPreviewView, mathjaxHelper, path, renderer;

  path = require('path');

  MarkdownPreviewView = require('../lib/markdown-preview-view');

  mathjaxHelper = require('../lib/mathjax-helper');

  renderer = require('../lib/renderer');

  describe("the difference algorithm that updates the preview", function() {
    var editor, loadPreviewInSplitPane, preview, ref, workspaceElement;
    ref = [], editor = ref[0], preview = ref[1], workspaceElement = ref[2];
    beforeEach(function() {
      jasmine.useRealClock();
      workspaceElement = atom.views.getView(atom.workspace);
      jasmine.attachToDOM(workspaceElement);
      waitsForPromise(function() {
        return atom.packages.activatePackage("markdown-preview-plus");
      });
      waitsForPromise(function() {
        return atom.workspace.open(path.join(__dirname, 'fixtures', 'sync.md'));
      });
      return runs(function() {
        return editor = atom.workspace.getPanes()[0].getActiveItem();
      });
    });
    afterEach(function() {
      return preview.destroy();
    });
    loadPreviewInSplitPane = function() {
      runs(function() {
        return atom.commands.dispatch(workspaceElement, 'markdown-preview-plus:toggle');
      });
      waitsFor(function() {
        return atom.workspace.getCenter().getPanes().length === 2;
      });
      waitsFor("markdown preview to be created", function() {
        return preview = atom.workspace.getCenter().getPanes()[1].getActiveItem();
      });
      return runs(function() {
        expect(preview).toBeInstanceOf(MarkdownPreviewView);
        return expect(preview.getPath()).toBe(atom.workspace.getActivePaneItem().getPath());
      });
    };
    describe("updating ordered lists start number", function() {
      var expectOrderedListsToStartAt, orderedLists;
      orderedLists = [][0];
      beforeEach(function() {
        loadPreviewInSplitPane();
        return runs(function() {
          return orderedLists = preview.find('ol');
        });
      });
      expectOrderedListsToStartAt = function(startNumbers) {
        return runs(function() {
          var i, j, ref1;
          for (i = j = 0, ref1 = startNumbers.length - 1; 0 <= ref1 ? j <= ref1 : j >= ref1; i = 0 <= ref1 ? ++j : --j) {
            if (startNumbers[i] === "1") {
              expect(orderedLists[i].getAttribute('start')).not.toExist();
            } else {
              expect(orderedLists[i].getAttribute('start')).toBe(startNumbers[i]);
            }
          }
        });
      };
      it("sets the start attribute when the start number isn't 1", function() {
        expectOrderedListsToStartAt(["1", "1", "1", "1", "1"]);
        runs(function() {
          return editor.setTextInBufferRange([[35, 0], [35, 12]], "2. Ordered 1");
        });
        waitsFor("1st ordered list start attribute to update", function() {
          return orderedLists[0].getAttribute('start') != null;
        });
        expectOrderedListsToStartAt(["2", "1", "1", "1", "1"]);
        runs(function() {
          return editor.setTextInBufferRange([[148, 0], [148, 14]], "> 2. Ordered 1");
        });
        waitsFor("ordered list nested in blockquote start attribute to update", function() {
          return orderedLists[2].getAttribute('start') != null;
        });
        expectOrderedListsToStartAt(["2", "1", "2", "1", "1"]);
        runs(function() {
          return editor.setTextInBufferRange([[205, 0], [205, 14]], "  2. Ordered 1");
        });
        waitsFor("ordered list nested in unordered list start attribute to update", function() {
          return orderedLists[3].getAttribute('start') != null;
        });
        return expectOrderedListsToStartAt(["2", "1", "2", "2", "1"]);
      });
      return it("removes the start attribute when the start number is changed to 1", function() {
        editor.setTextInBufferRange([[35, 0], [35, 12]], "2. Ordered 1");
        editor.setTextInBufferRange([[148, 0], [148, 14]], "> 2. Ordered 1");
        editor.setTextInBufferRange([[205, 0], [205, 14]], "  2. Ordered 1");
        waitsFor("ordered lists start attributes to update", function() {
          return (orderedLists[0].getAttribute('start') != null) && (orderedLists[2].getAttribute('start') != null) && (orderedLists[3].getAttribute('start') != null);
        });
        expectOrderedListsToStartAt(["2", "1", "2", "2", "1"]);
        runs(function() {
          return editor.setTextInBufferRange([[35, 0], [35, 12]], "1. Ordered 1");
        });
        waitsFor("1st ordered list start attribute to be removed", function() {
          return orderedLists[0].getAttribute('start') == null;
        });
        expectOrderedListsToStartAt(["1", "1", "2", "2", "1"]);
        runs(function() {
          return editor.setTextInBufferRange([[148, 0], [148, 14]], "> 1. Ordered 1");
        });
        waitsFor("ordered list nested in blockquote start attribute to be removed", function() {
          return orderedLists[2].getAttribute('start') == null;
        });
        expectOrderedListsToStartAt(["1", "1", "1", "2", "1"]);
        runs(function() {
          return editor.setTextInBufferRange([[205, 0], [205, 14]], "  1. Ordered 1");
        });
        waitsFor("ordered list nested in unordered list start attribute to be removed", function() {
          return orderedLists[3].getAttribute('start') == null;
        });
        return expectOrderedListsToStartAt(["1", "1", "1", "1", "1"]);
      });
    });
    describe("when a maths block is modified", function() {
      var mathBlocks;
      mathBlocks = [][0];
      beforeEach(function() {
        waitsFor("LaTeX rendering to be enabled", function() {
          return atom.config.set('markdown-preview-plus.enableLatexRenderingByDefault', true);
        });
        loadPreviewInSplitPane();
        waitsFor("MathJax to load", function() {
          return typeof MathJax !== "undefined" && MathJax !== null;
        });
        waitsFor("preview to update DOM with span.math containers", function() {
          mathBlocks = preview.find('script[type*="math/tex"]').parent();
          return mathBlocks.length === 20;
        });
        return waitsFor("Maths blocks to be processed by MathJax", function() {
          mathBlocks = preview.find('script[type*="math/tex"]').parent();
          return mathBlocks.children('span.MathJax, div.MathJax_Display').not('.MathJax_Processing').length === 20;
        });
      });
      afterEach(function() {
        return mathjaxHelper.resetMathJax();
      });
      it("replaces the entire span.math container element", function() {
        spyOn(mathjaxHelper, 'mathProcessor').andCallFake(function() {});
        runs(function() {
          return editor.setTextInBufferRange([[46, 0], [46, 43]], "E=mc^2");
        });
        waitsFor("mathjaxHelper.mathProcessor to be called", function() {
          return mathjaxHelper.mathProcessor.calls.length;
        });
        return runs(function() {
          var mathHTMLCSS, modMathBlock;
          mathBlocks = preview.find('script[type*="math/tex"]').parent();
          expect(mathBlocks.length).toBe(20);
          mathHTMLCSS = mathBlocks.children('span.MathJax, div.MathJax_Display');
          expect(mathHTMLCSS.length).toBe(19);
          modMathBlock = mathBlocks.eq(2);
          expect(modMathBlock.children().length).toBe(1);
          return expect(modMathBlock.children('script').text()).toBe("E=mc^2\n");
        });
      });
      return it("subsequently only rerenders the maths block that was modified", function() {
        var unprocessedMathBlocks;
        unprocessedMathBlocks = [][0];
        spyOn(mathjaxHelper, 'mathProcessor').andCallFake(function(domElements) {
          return unprocessedMathBlocks = domElements;
        });
        runs(function() {
          return editor.setTextInBufferRange([[46, 0], [46, 43]], "E=mc^2");
        });
        waitsFor("mathjaxHelper.mathProcessor to be called", function() {
          return mathjaxHelper.mathProcessor.calls.length;
        });
        return runs(function() {
          expect(unprocessedMathBlocks.length).toBe(1);
          expect(unprocessedMathBlocks[0].tagName.toLowerCase()).toBe('span');
          expect(unprocessedMathBlocks[0].className).toBe('math');
          expect(unprocessedMathBlocks[0].children.length).toBe(1);
          return expect(unprocessedMathBlocks[0].children[0].textContent).toBe("E=mc^2\n");
        });
      });
    });
    return describe("when a code block is modified", function() {
      return it("replaces the entire span.atom-text-editor container element", function() {
        loadPreviewInSplitPane();
        runs(function() {
          var atomTextEditors, codeBlocks;
          codeBlocks = preview.find('span.atom-text-editor');
          expect(codeBlocks.length).toBe(5);
          expect(codeBlocks.children().length).toBe(5);
          atomTextEditors = codeBlocks.children('atom-text-editor');
          expect(atomTextEditors.length).toBe(5);
          spyOn(renderer, 'convertCodeBlocksToAtomEditors').andCallFake(function() {});
          return editor.setTextInBufferRange([[24, 0], [24, 9]], "This is a modified");
        });
        waitsFor("renderer.convertCodeBlocksToAtomEditors to be called", function() {
          return renderer.convertCodeBlocksToAtomEditors.calls.length;
        });
        return runs(function() {
          var atomTextEditors, codeBlocks, modCodeBlock;
          codeBlocks = preview.find('span.atom-text-editor');
          expect(codeBlocks.length).toBe(5);
          expect(codeBlocks.children().length).toBe(5);
          atomTextEditors = codeBlocks.children('atom-text-editor');
          expect(atomTextEditors.length).toBe(4);
          modCodeBlock = codeBlocks.eq(0);
          expect(modCodeBlock.children().length).toBe(1);
          return expect(modCodeBlock.children().prop('tagName').toLowerCase()).toBe('pre');
        });
      });
    });
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiL2hvbWUvamVzdXMvLmF0b20vcGFja2FnZXMvbWFya2Rvd24tcHJldmlldy1wbHVzL3NwZWMvdXBkYXRlLXByZXZpZXctc3BlYy5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQSxNQUFBOztFQUFBLElBQUEsR0FBc0IsT0FBQSxDQUFRLE1BQVI7O0VBQ3RCLG1CQUFBLEdBQXNCLE9BQUEsQ0FBUSw4QkFBUjs7RUFDdEIsYUFBQSxHQUFzQixPQUFBLENBQVEsdUJBQVI7O0VBQ3RCLFFBQUEsR0FBc0IsT0FBQSxDQUFRLGlCQUFSOztFQUV0QixRQUFBLENBQVMsbURBQVQsRUFBOEQsU0FBQTtBQUM1RCxRQUFBO0lBQUEsTUFBc0MsRUFBdEMsRUFBQyxlQUFELEVBQVMsZ0JBQVQsRUFBa0I7SUFFbEIsVUFBQSxDQUFXLFNBQUE7TUFDVCxPQUFPLENBQUMsWUFBUixDQUFBO01BQ0EsZ0JBQUEsR0FBbUIsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFYLENBQW1CLElBQUksQ0FBQyxTQUF4QjtNQUNuQixPQUFPLENBQUMsV0FBUixDQUFvQixnQkFBcEI7TUFFQSxlQUFBLENBQWdCLFNBQUE7ZUFDZCxJQUFJLENBQUMsUUFBUSxDQUFDLGVBQWQsQ0FBOEIsdUJBQTlCO01BRGMsQ0FBaEI7TUFHQSxlQUFBLENBQWdCLFNBQUE7ZUFDZCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQWYsQ0FBb0IsSUFBSSxDQUFDLElBQUwsQ0FBVSxTQUFWLEVBQXFCLFVBQXJCLEVBQWlDLFNBQWpDLENBQXBCO01BRGMsQ0FBaEI7YUFHQSxJQUFBLENBQUssU0FBQTtlQUNILE1BQUEsR0FBUyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQWYsQ0FBQSxDQUEwQixDQUFBLENBQUEsQ0FBRSxDQUFDLGFBQTdCLENBQUE7TUFETixDQUFMO0lBWFMsQ0FBWDtJQWNBLFNBQUEsQ0FBVSxTQUFBO2FBQ1IsT0FBTyxDQUFDLE9BQVIs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UUFBUSxDQUFDLDhCQUE4QixDQUFDLEtBQUssQ0FBQztRQURpQixDQUFqRTtlQUdBLElBQUEsQ0FBSyxTQUFBO0FBQ0gsY0FBQTtVQUFBLFVBQUEsR0FBYSxPQUFPLENBQUMsSUFBUixDQUFhLHVCQUFiO1VBQ2IsTUFBQSxDQUFPLFVBQVUsQ0FBQyxNQUFsQixDQUF5QixDQUFDLElBQTFCLENBQStCLENBQS9CO1VBQ0EsTUFBQSxDQUFPLFVBQVUsQ0FBQyxRQUFYLENBQUEsQ0FBcUIsQ0FBQyxNQUE3QixDQUFvQyxDQUFDLElBQXJDLENBQTBDLENBQTFDO1VBRUEsZUFBQSxHQUFrQixVQUFVLENBQUMsUUFBWCxDQUFvQixrQkFBcEI7VUFDbEIsTUFBQSxDQUFPLGVBQWUsQ0FBQyxNQUF2QixDQUE4QixDQUFDLElBQS9CLENBQW9DLENBQXBDO1VBRUEsWUFBQSxHQUFlLFVBQVUsQ0FBQyxFQUFYLENBQWMsQ0FBZDtVQUNmLE1BQUEsQ0FBTyxZQUFZLENBQUMsUUFBYixDQUFBLENBQXVCLENBQUMsTUFBL0IsQ0FBc0MsQ0FBQyxJQUF2QyxDQUE0QyxDQUE1QztpQkFDQSxNQUFBLENBQU8sWUFBWSxDQUFDLFFBQWIsQ0FBQSxDQUF1QixDQUFDLElBQXhCLENBQTZCLFNBQTdCLENBQXVDLENBQUMsV0FBeEMsQ0FBQSxDQUFQLENBQTZELENBQUMsSUFBOUQsQ0FBbUUsS0FBbkU7UUFWRyxDQUFMO01BakJnRSxDQUFsRTtJQUR3QyxDQUExQztFQXhKNEQsQ0FBOUQ7QUFMQSIsInNvdXJjZXNDb250ZW50IjpbInBhdGggICAgICAgICAgICAgICAgPSByZXF1aXJlICdwYXRoJ1xuTWFya2Rvd25QcmV2aWV3VmlldyA9IHJlcXVpcmUgJy4uL2xpYi9tYXJrZG93bi1wcmV2aWV3LXZpZXcnXG5tYXRoamF4SGVscGVyICAgICAgID0gcmVxdWlyZSAnLi4vbGliL21hdGhqYXgtaGVscGVyJ1xucmVuZGVyZXIgICAgICAgICAgICA9IHJlcXVpcmUgJy4uL2xpYi9yZW5kZXJlcidcblxuZGVzY3JpYmUgXCJ0aGUgZGlmZmVyZW5jZSBhbGdvcml0aG0gdGhhdCB1cGRhdGVzIHRoZSBwcmV2aWV3XCIsIC0+XG4gIFtlZGl0b3IsIHByZXZpZXcsIHdvcmtzcGFjZUVsZW1lbnRdID0gW11cblxuICBiZWZvcmVFYWNoIC0+XG4gICAgamFzbWluZS51c2VSZWFsQ2xvY2soKVxuICAgIHdvcmtzcGFjZUVsZW1lbnQgPSBhdG9tLnZpZXdzLmdldFZpZXcoYXRvbS53b3Jrc3BhY2UpXG4gICAgamFzbWluZS5hdHRhY2hUb0RPTSB3b3Jrc3BhY2VFbGVtZW50XG5cbiAgICB3YWl0c0ZvclByb21pc2UgLT5cbiAgICAgIGF0b20ucGFja2FnZXMuYWN0aXZhdGVQYWNrYWdlKFwibWFya2Rvd24tcHJldmlldy1wbHVzXCIpXG5cbiAgICB3YWl0c0ZvclByb21pc2UgLT5cbiAgICAgIGF0b20ud29ya3NwYWNlLm9wZW4gcGF0aC5qb2luKF9fZGlybmFtZSwgJ2ZpeHR1cmVzJywgJ3N5bmMubWQnKVxuXG4gICAgcnVucyAtPlxuICAgICAgZWRpdG9yID0gYXRvbS53b3Jrc3BhY2UuZ2V0UGFuZXMoKVswXS5nZXRBY3RpdmVJdGVtKClcblxuICBhZnRlckVhY2ggLT5cbiAgICBwcmV2aWV3LmRlc3Ryb3koKVxuXG4gIGxvYWRQcmV2aWV3SW5TcGxpdFBhbmUgPSAtPlxuICAgIHJ1bnMgLT5cbiAgICAgIGF0b20uY29tbWFuZHMuZGlzcGF0Y2ggd29ya3NwYWNlRWxlbWVudCwgJ21hcmtkb3duLXByZXZpZXctcGx1czp0b2dnbGUnXG5cbiAgICB3YWl0c0ZvciAtPlxuICAgICAgYXRvbS53b3Jrc3BhY2UuZ2V0Q2VudGVyKCkuZ2V0UGFuZXMoKS5sZW5ndGggaXMgMlxuXG4gICAgd2FpdHNGb3IgXCJtYXJrZG93biBwcmV2aWV3IHRvIGJlIGNyZWF0ZWRcIiwgLT5cbiAgICAgIHByZXZpZXcgPSBhdG9tLndvcmtzcGFjZS5nZXRDZW50ZXIoKS5nZXRQYW5lcygpWzFdLmdldEFjdGl2ZUl0ZW0oKVxuXG4gICAgcnVucyAtPlxuICAgICAgZXhwZWN0KHByZXZpZXcpLnRvQmVJbnN0YW5jZU9mKE1hcmtkb3duUHJldmlld1ZpZXcpXG4gICAgICBleHBlY3QocHJldmlldy5nZXRQYXRoKCkpLnRvQmUgYXRvbS53b3Jrc3BhY2UuZ2V0QWN0aXZlUGFuZUl0ZW0oKS5nZXRQYXRoKClcblxuICBkZXNjcmliZSBcInVwZGF0aW5nIG9yZGVyZWQgbGlzdHMgc3RhcnQgbnVtYmVyXCIsIC0+XG4gICAgW29yZGVyZWRMaXN0c10gPSBbXVxuXG4gICAgYmVmb3JlRWFjaCAtPlxuICAgICAgbG9hZFByZXZpZXdJblNwbGl0UGFuZSgpXG4gICAgICBydW5zIC0+IG9yZGVyZWRMaXN0cyA9IHByZXZpZXcuZmluZCgnb2wnKVxuXG4gICAgZXhwZWN0T3JkZXJlZExpc3RzVG9TdGFydEF0ID0gKHN0YXJ0TnVtYmVycykgLT5cbiAgICAgIHJ1bnMgLT5cbiAgICAgICAgZm9yIGkgaW4gWzAuLihzdGFydE51bWJlcnMubGVuZ3RoLTEpXVxuICAgICAgICAgIGlmIHN0YXJ0TnVtYmVyc1tpXSBpcyBcIjFcIlxuICAgICAgICAgIHRoZW4gZXhwZWN0KG9yZGVyZWRMaXN0c1tpXS5nZXRBdHRyaWJ1dGUoJ3N0YXJ0JykpLm5vdC50b0V4aXN0KClcbiAgICAgICAgICBlbHNlIGV4cGVjdChvcmRlcmVkTGlzdHNbaV0uZ2V0QXR0cmlidXRlKCdzdGFydCcpKS50b0JlKHN0YXJ0TnVtYmVyc1tpXSlcbiAgICAgICAgcmV0dXJuXG5cbiAgICBpdCBcInNldHMgdGhlIHN0YXJ0IGF0dHJpYnV0ZSB3aGVuIHRoZSBzdGFydCBudW1iZXIgaXNuJ3QgMVwiLCAtPlxuICAgICAgZXhwZWN0T3JkZXJlZExpc3RzVG9TdGFydEF0IFtcIjFcIiwgXCIxXCIsIFwiMVwiLCBcIjFcIiwgXCIxXCJdXG5cbiAgICAgIHJ1bnMgLT4gZWRpdG9yLnNldFRleHRJbkJ1ZmZlclJhbmdlKFtbMzUsIDBdLCBbMzUsIDEyXV0sIFwiMi4gT3JkZXJlZCAxXCIpXG4gICAgICB3YWl0c0ZvciBcIjFzdCBvcmRlcmVkIGxpc3Qgc3RhcnQgYXR0cmlidXRlIHRvIHVwZGF0ZVwiLCAtPlxuICAgICAgICBvcmRlcmVkTGlzdHNbMF0uZ2V0QXR0cmlidXRlKCdzdGFydCcpP1xuICAgICAgZXhwZWN0T3JkZXJlZExpc3RzVG9TdGFydEF0IFtcIjJcIiwgXCIxXCIsIFwiMVwiLCBcIjFcIiwgXCIxXCJdXG5cbiAgICAgIHJ1bnMgLT4gZWRpdG9yLnNldFRleHRJbkJ1ZmZlclJhbmdlKFtbMTQ4LCAwXSwgWzE0OCwgMTRdXSwgXCI+IDIuIE9yZGVyZWQgMVwiKVxuICAgICAgd2FpdHNGb3IgXCJvcmRlcmVkIGxpc3QgbmVzdGVkIGluIGJsb2NrcXVvdGUgc3RhcnQgYXR0cmlidXRlIHRvIHVwZGF0ZVwiLCAtPlxuICAgICAgICBvcmRlcmVkTGlzdHNbMl0uZ2V0QXR0cmlidXRlKCdzdGFydCcpP1xuICAgICAgZXhwZWN0T3JkZXJlZExpc3RzVG9TdGFydEF0IFtcIjJcIiwgXCIxXCIsIFwiMlwiLCBcIjFcIiwgXCIxXCJdXG5cbiAgICAgIHJ1bnMgLT4gZWRpdG9yLnNldFRleHRJbkJ1ZmZlclJhbmdlKFtbMjA1LCAwXSwgWzIwNSwgMTRdXSwgXCIgIDIuIE9yZGVyZWQgMVwiKVxuICAgICAgd2FpdHNGb3IgXCJvcmRlcmVkIGxpc3QgbmVzdGVkIGluIHVub3JkZXJlZCBsaXN0IHN0YXJ0IGF0dHJpYnV0ZSB0byB1cGRhdGVcIiwgLT5cbiAgICAgICAgb3JkZXJlZExpc3RzWzNdLmdldEF0dHJpYnV0ZSgnc3RhcnQnKT9cbiAgICAgIGV4cGVjdE9yZGVyZWRMaXN0c1RvU3RhcnRBdCBbXCIyXCIsIFwiMVwiLCBcIjJcIiwgXCIyXCIsIFwiMVwiXVxuXG4gICAgaXQgXCJyZW1vdmVzIHRoZSBzdGFydCBhdHRyaWJ1dGUgd2hlbiB0aGUgc3RhcnQgbnVtYmVyIGlzIGNoYW5nZWQgdG8gMVwiLCAtPlxuICAgICAgZWRpdG9yLnNldFRleHRJbkJ1ZmZlclJhbmdlKFtbMzUsIDBdLCBbMzUsIDEyXV0sIFwiMi4gT3JkZXJlZCAxXCIpXG4gICAgICBlZGl0b3Iuc2V0VGV4dEluQnVmZmVyUmFuZ2UoW1sxNDgsIDBdLCBbMTQ4LCAxNF1dLCBcIj4gMi4gT3JkZXJlZCAxXCIpXG4gICAgICBlZGl0b3Iuc2V0VGV4dEluQnVmZmVyUmFuZ2UoW1syMDUsIDBdLCBbMjA1LCAxNF1dLCBcIiAgMi4gT3JkZXJlZCAxXCIpXG4gICAgICB3YWl0c0ZvciBcIm9yZGVyZWQgbGlzdHMgc3RhcnQgYXR0cmlidXRlcyB0byB1cGRhdGVcIiwgLT5cbiAgICAgICAgb3JkZXJlZExpc3RzWzBdLmdldEF0dHJpYnV0ZSgnc3RhcnQnKT8gYW5kXG4gICAgICAgIG9yZGVyZWRMaXN0c1syXS5nZXRBdHRyaWJ1dGUoJ3N0YXJ0Jyk/IGFuZFxuICAgICAgICBvcmRlcmVkTGlzdHNbM10uZ2V0QXR0cmlidXRlKCdzdGFydCcpP1xuICAgICAgZXhwZWN0T3JkZXJlZExpc3RzVG9TdGFydEF0IFtcIjJcIiwgXCIxXCIsIFwiMlwiLCBcIjJcIiwgXCIxXCJdXG5cbiAgICAgIHJ1bnMgLT4gZWRpdG9yLnNldFRleHRJbkJ1ZmZlclJhbmdlKFtbMzUsIDBdLCBbMzUsIDEyXV0sIFwiMS4gT3JkZXJlZCAxXCIpXG4gICAgICB3YWl0c0ZvciBcIjFzdCBvcmRlcmVkIGxpc3Qgc3RhcnQgYXR0cmlidXRlIHRvIGJlIHJlbW92ZWRcIiwgLT5cbiAgICAgICAgbm90IG9yZGVyZWRMaXN0c1swXS5nZXRBdHRyaWJ1dGUoJ3N0YXJ0Jyk/XG4gICAgICBleHBlY3RPcmRlcmVkTGlzdHNUb1N0YXJ0QXQgW1wiMVwiLCBcIjFcIiwgXCIyXCIsIFwiMlwiLCBcIjFcIl1cblxuICAgICAgcnVucyAtPiBlZGl0b3Iuc2V0VGV4dEluQnVmZmVyUmFuZ2UoW1sxNDgsIDBdLCBbMTQ4LCAxNF1dLCBcIj4gMS4gT3JkZXJlZCAxXCIpXG4gICAgICB3YWl0c0ZvciBcIm9yZGVyZWQgbGlzdCBuZXN0ZWQgaW4gYmxvY2txdW90ZSBzdGFydCBhdHRyaWJ1dGUgdG8gYmUgcmVtb3ZlZFwiLCAtPlxuICAgICAgICBub3Qgb3JkZXJlZExpc3RzWzJdLmdldEF0dHJpYnV0ZSgnc3RhcnQnKT9cbiAgICAgIGV4cGVjdE9yZGVyZWRMaXN0c1RvU3RhcnRBdCBbXCIxXCIsIFwiMVwiLCBcIjFcIiwgXCIyXCIsIFwiMVwiXVxuXG4gICAgICBydW5zIC0+IGVkaXRvci5zZXRUZXh0SW5CdWZmZXJSYW5nZShbWzIwNSwgMF0sIFsyMDUsIDE0XV0sIFwiICAxLiBPcmRlcmVkIDFcIilcbiAgICAgIHdhaXRzRm9yIFwib3JkZXJlZCBsaXN0IG5lc3RlZCBpbiB1bm9yZGVyZWQgbGlzdCBzdGFydCBhdHRyaWJ1dGUgdG8gYmUgcmVtb3ZlZFwiLCAtPlxuICAgICAgICBub3Qgb3JkZXJlZExpc3RzWzNdLmdldEF0dHJpYnV0ZSgnc3RhcnQnKT9cbiAgICAgIGV4cGVjdE9yZGVyZWRMaXN0c1RvU3RhcnRBdCBbXCIxXCIsIFwiMVwiLCBcIjFcIiwgXCIxXCIsIFwiMVwiXVxuXG4gIGRlc2NyaWJlIFwid2hlbiBhIG1hdGhzIGJsb2NrIGlzIG1vZGlmaWVkXCIsIC0+XG4gICAgW21hdGhCbG9ja3NdID0gW11cblxuICAgIGJlZm9yZUVhY2ggLT5cbiAgICAgIHdhaXRzRm9yIFwiTGFUZVggcmVuZGVyaW5nIHRvIGJlIGVuYWJsZWRcIiwgLT5cbiAgICAgICAgYXRvbS5jb25maWcuc2V0ICdtYXJrZG93bi1wcmV2aWV3LXBsdXMuZW5hYmxlTGF0ZXhSZW5kZXJpbmdCeURlZmF1bHQnLCB0cnVlXG5cbiAgICAgIGxvYWRQcmV2aWV3SW5TcGxpdFBhbmUoKVxuXG4gICAgICB3YWl0c0ZvciBcIk1hdGhKYXggdG8gbG9hZFwiLCAtPlxuICAgICAgICBNYXRoSmF4P1xuXG4gICAgICB3YWl0c0ZvciBcInByZXZpZXcgdG8gdXBkYXRlIERPTSB3aXRoIHNwYW4ubWF0aCBjb250YWluZXJzXCIsIC0+XG4gICAgICAgIG1hdGhCbG9ja3MgPSBwcmV2aWV3LmZpbmQoJ3NjcmlwdFt0eXBlKj1cIm1hdGgvdGV4XCJdJykucGFyZW50KClcbiAgICAgICAgbWF0aEJsb2Nrcy5sZW5ndGggaXMgMjBcblxuICAgICAgd2FpdHNGb3IgXCJNYXRocyBibG9ja3MgdG8gYmUgcHJvY2Vzc2VkIGJ5IE1hdGhKYXhcIiwgLT5cbiAgICAgICAgbWF0aEJsb2NrcyA9IHByZXZpZXcuZmluZCgnc2NyaXB0W3R5cGUqPVwibWF0aC90ZXhcIl0nKS5wYXJlbnQoKVxuICAgICAgICBtYXRoQmxvY2tzLmNoaWxkcmVuKCdzcGFuLk1hdGhKYXgsIGRpdi5NYXRoSmF4X0Rpc3BsYXknKS5ub3QoJy5NYXRoSmF4X1Byb2Nlc3NpbmcnKS5sZW5ndGggaXMgMjBcblxuICAgIGFmdGVyRWFjaCAtPlxuICAgICAgbWF0aGpheEhlbHBlci5yZXNldE1hdGhKYXgoKVxuXG4gICAgaXQgXCJyZXBsYWNlcyB0aGUgZW50aXJlIHNwYW4ubWF0aCBjb250YWluZXIgZWxlbWVudFwiLCAtPlxuICAgICAgc3B5T24obWF0aGpheEhlbHBlciwgJ21hdGhQcm9jZXNzb3InKS5hbmRDYWxsRmFrZSAtPiByZXR1cm5cblxuICAgICAgcnVucyAtPiBlZGl0b3Iuc2V0VGV4dEluQnVmZmVyUmFuZ2UoW1s0NiwgMF0sIFs0NiwgNDNdXSwgXCJFPW1jXjJcIilcblxuICAgICAgd2FpdHNGb3IgXCJtYXRoamF4SGVscGVyLm1hdGhQcm9jZXNzb3IgdG8gYmUgY2FsbGVkXCIsIC0+XG4gICAgICAgIG1hdGhqYXhIZWxwZXIubWF0aFByb2Nlc3Nvci5jYWxscy5sZW5ndGhcblxuICAgICAgcnVucyAtPlxuICAgICAgICBtYXRoQmxvY2tzICA9IHByZXZpZXcuZmluZCgnc2NyaXB0W3R5cGUqPVwibWF0aC90ZXhcIl0nKS5wYXJlbnQoKVxuICAgICAgICBleHBlY3QobWF0aEJsb2Nrcy5sZW5ndGgpLnRvQmUoMjApXG5cbiAgICAgICAgbWF0aEhUTUxDU1MgPSBtYXRoQmxvY2tzLmNoaWxkcmVuKCdzcGFuLk1hdGhKYXgsIGRpdi5NYXRoSmF4X0Rpc3BsYXknKVxuICAgICAgICBleHBlY3QobWF0aEhUTUxDU1MubGVuZ3RoKS50b0JlKDE5KVxuXG4gICAgICAgIG1vZE1hdGhCbG9jayA9IG1hdGhCbG9ja3MuZXEoMilcbiAgICAgICAgZXhwZWN0KG1vZE1hdGhCbG9jay5jaGlsZHJlbigpLmxlbmd0aCkudG9CZSgxKVxuICAgICAgICBleHBlY3QobW9kTWF0aEJsb2NrLmNoaWxkcmVuKCdzY3JpcHQnKS50ZXh0KCkpLnRvQmUoXCJFPW1jXjJcXG5cIilcblxuICAgIGl0IFwic3Vic2VxdWVudGx5IG9ubHkgcmVyZW5kZXJzIHRoZSBtYXRocyBibG9jayB0aGF0IHdhcyBtb2RpZmllZFwiLCAtPlxuICAgICAgW3VucHJvY2Vzc2VkTWF0aEJsb2Nrc10gPSBbXVxuXG4gICAgICBzcHlPbihtYXRoamF4SGVscGVyLCAnbWF0aFByb2Nlc3NvcicpLmFuZENhbGxGYWtlIChkb21FbGVtZW50cykgLT5cbiAgICAgICAgdW5wcm9jZXNzZWRNYXRoQmxvY2tzID0gZG9tRWxlbWVudHNcblxuICAgICAgcnVucyAtPiBlZGl0b3Iuc2V0VGV4dEluQnVmZmVyUmFuZ2UoW1s0NiwgMF0sIFs0NiwgNDNdXSwgXCJFPW1jXjJcIilcblxuICAgICAgd2FpdHNGb3IgXCJtYXRoamF4SGVscGVyLm1hdGhQcm9jZXNzb3IgdG8gYmUgY2FsbGVkXCIsIC0+XG4gICAgICAgIG1hdGhqYXhIZWxwZXIubWF0aFByb2Nlc3Nvci5jYWxscy5sZW5ndGhcblxuICAgICAgcnVucyAtPlxuICAgICAgICBleHBlY3QodW5wcm9jZXNzZWRNYXRoQmxvY2tzLmxlbmd0aCkudG9CZSgxKVxuICAgICAgICBleHBlY3QodW5wcm9jZXNzZWRNYXRoQmxvY2tzWzBdLnRhZ05hbWUudG9Mb3dlckNhc2UoKSkudG9CZSgnc3BhbicpXG4gICAgICAgIGV4cGVjdCh1bnByb2Nlc3NlZE1hdGhCbG9ja3NbMF0uY2xhc3NOYW1lKS50b0JlKCdtYXRoJylcbiAgICAgICAgZXhwZWN0KHVucHJvY2Vzc2VkTWF0aEJsb2Nrc1swXS5jaGlsZHJlbi5sZW5ndGgpLnRvQmUoMSlcbiAgICAgICAgZXhwZWN0KHVucHJvY2Vzc2VkTWF0aEJsb2Nrc1swXS5jaGlsZHJlblswXS50ZXh0Q29udGVudCkudG9CZShcIkU9bWNeMlxcblwiKVxuXG4gIGRlc2NyaWJlIFwid2hlbiBhIGNvZGUgYmxvY2sgaXMgbW9kaWZpZWRcIiwgLT5cbiAgICBpdCBcInJlcGxhY2VzIHRoZSBlbnRpcmUgc3Bhbi5hdG9tLXRleHQtZWRpdG9yIGNvbnRhaW5lciBlbGVtZW50XCIsIC0+XG4gICAgICBsb2FkUHJldmlld0luU3BsaXRQYW5lKClcblxuICAgICAgcnVucyAtPlxuICAgICAgICBjb2RlQmxvY2tzID0gcHJldmlldy5maW5kKCdzcGFuLmF0b20tdGV4dC1lZGl0b3InKVxuICAgICAgICBleHBlY3QoY29kZUJsb2Nrcy5sZW5ndGgpLnRvQmUoNSlcbiAgICAgICAgZXhwZWN0KGNvZGVCbG9ja3MuY2hpbGRyZW4oKS5sZW5ndGgpLnRvQmUoNSlcblxuICAgICAgICBhdG9tVGV4dEVkaXRvcnMgPSBjb2RlQmxvY2tzLmNoaWxkcmVuKCdhdG9tLXRleHQtZWRpdG9yJylcbiAgICAgICAgZXhwZWN0KGF0b21UZXh0RWRpdG9ycy5sZW5ndGgpLnRvQmUoNSlcblxuICAgICAgICBzcHlPbihyZW5kZXJlciwgJ2NvbnZlcnRDb2RlQmxvY2tzVG9BdG9tRWRpdG9ycycpLmFuZENhbGxGYWtlIC0+IHJldHVyblxuICAgICAgICBlZGl0b3Iuc2V0VGV4dEluQnVmZmVyUmFuZ2UoW1syNCwgMF0sIFsyNCwgOV1dLCBcIlRoaXMgaXMgYSBtb2RpZmllZFwiKVxuXG4gICAgICB3YWl0c0ZvciBcInJlbmRlcmVyLmNvbnZlcnRDb2RlQmxvY2tzVG9BdG9tRWRpdG9ycyB0byBiZSBjYWxsZWRcIiwgLT5cbiAgICAgICAgcmVuZGVyZXIuY29udmVydENvZGVCbG9ja3NUb0F0b21FZGl0b3JzLmNhbGxzLmxlbmd0aFxuXG4gICAgICBydW5zIC0+XG4gICAgICAgIGNvZGVCbG9ja3MgPSBwcmV2aWV3LmZpbmQoJ3NwYW4uYXRvbS10ZXh0LWVkaXRvcicpXG4gICAgICAgIGV4cGVjdChjb2RlQmxvY2tzLmxlbmd0aCkudG9CZSg1KVxuICAgICAgICBleHBlY3QoY29kZUJsb2Nrcy5jaGlsZHJlbigpLmxlbmd0aCkudG9CZSg1KVxuXG4gICAgICAgIGF0b21UZXh0RWRpdG9ycyA9IGNvZGVCbG9ja3MuY2hpbGRyZW4oJ2F0b20tdGV4dC1lZGl0b3InKVxuICAgICAgICBleHBlY3QoYXRvbVRleHRFZGl0b3JzLmxlbmd0aCkudG9CZSg0KVxuXG4gICAgICAgIG1vZENvZGVCbG9jayA9IGNvZGVCbG9ja3MuZXEoMClcbiAgICAgICAgZXhwZWN0KG1vZENvZGVCbG9jay5jaGlsZHJlbigpLmxlbmd0aCkudG9CZSgxKVxuICAgICAgICBleHBlY3QobW9kQ29kZUJsb2NrLmNoaWxkcmVuKCkucHJvcCgndGFnTmFtZScpLnRvTG93ZXJDYXNlKCkpLnRvQmUoJ3ByZScpXG4iXX0=
